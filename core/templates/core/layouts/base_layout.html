{% load static %}
{# HydroML Base Layout Template - Wave Theme Integration #}
<!DOCTYPE html>
<html lang="es" class="h-full" :class="{ 'dark': darkMode }">

<!-- Head Section -->
{% include 'core/partials/_base_head.html' %}

<body class="h-full bg-background-primary dark:bg-onedark-background font-sans antialiased layout-{% block layout_type %}full{% endblock %}" 
      x-data="hydroMLApp" x-init="init()">
    
    <!-- Head Scripts -->
    {% include 'core/partials/_base_scripts_head.html' %}

    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-brand-primary text-white px-4 py-2 rounded-md z-50">
        Skip to main content
    </a>

    <!-- Layout Container -->
    <div class="layout-{% block layout_class %}full{% endblock %}">
        
        <!-- Header -->
        <header class="layout-header bg-background-primary dark:bg-darcula-background border-b border-border-default dark:border-darcula-border sticky top-0 z-40" 
                role="banner">
            {% block header %}
                {% include 'core/layouts/partials/_default_header.html' %}
            {% endblock %}
        </header>

        <!-- Sidebar (if needed) -->
        {% block sidebar %}{% endblock %}

        <!-- Main Content -->
        <main class="layout-content bg-background-primary dark:bg-onedark-background overflow-y-auto" 
              id="main-content" 
              role="main"
              aria-label="Main content">
            
            <!-- Page Header -->
            {% block page_header %}
                <div class="container py-6">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div>
                            {% block breadcrumbs %}
                                {# Breadcrumbs will be implemented here #}
                            {% endblock %}
                            
                            {% if page_title %}
                                <h1 class="text-2xl font-bold text-foreground-default dark:text-darcula-foreground mt-2">
                                    {{ page_title }}
                                </h1>
                            {% endif %}
                            
                            {% block page_heading %}{% endblock %}
                            
                            {% block page_description %}{% endblock %}
                        </div>
                        
                        {% block page_actions %}{% endblock %}
                    </div>
                </div>
            {% endblock %}

            <!-- Messages -->
            {% block messages %}
                <div class="container">
                    {% include 'core/partials/_messages.html' %}
                </div>
            {% endblock %}

            <!-- Page Content -->
            <div class="container pb-8">
                {% block main_content %}{% endblock %}
            </div>
        </main>

        <!-- Aside (if needed) -->
        {% block aside %}{% endblock %}
    </div>

    <!-- Modal Container -->
    {% block modals %}
        <div id="modal-container" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
            <!-- Modal backdrop -->
            <div class="fixed inset-0 bg-black/50 transition-opacity"></div>
            
            <!-- Modal content will be dynamically inserted here -->
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div class="bg-background-primary dark:bg-darcula-background-darker border border-border-default dark:border-darcula-border rounded-lg shadow-xl max-w-lg w-full max-h-full overflow-auto">
                    <!-- Dynamic modal content -->
                </div>
            </div>
        </div>
    {% endblock %}

    <!-- Notification Container -->
    {% block notifications %}
        <div id="notification-container" 
             class="fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full"
             x-data="{ notifications: [] }"
             @hydroml:notify.window="notifications.push($event.detail)">
            
            <template x-for="notification in notifications" :key="notification.id">
                <div class="bg-background-primary dark:bg-darcula-background-darker border border-border-default dark:border-darcula-border rounded-lg shadow-lg p-4 transition-all duration-300"
                     x-show="notification"
                     x-transition:enter="transform transition ease-out duration-300"
                     x-transition:enter-start="translate-x-full opacity-0"
                     x-transition:enter-end="translate-x-0 opacity-100"
                     x-transition:leave="transform transition ease-in duration-200"
                     x-transition:leave-start="translate-x-0 opacity-100"
                     x-transition:leave-end="translate-x-full opacity-0">
                    
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <span x-text="notification.icon || 'ðŸ“‹'" class="text-lg"></span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-foreground-default dark:text-darcula-foreground" 
                               x-text="notification.message"></p>
                            <p class="text-xs text-foreground-muted dark:text-darcula-foreground-muted mt-1" 
                               x-text="notification.type"></p>
                        </div>
                        <button @click="notifications.splice(notifications.indexOf(notification), 1)"
                                class="flex-shrink-0 text-foreground-muted hover:text-foreground-default transition-colors">
                            <span class="sr-only">Close</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    {% endblock %}

    <!-- Global Loading Overlay -->
    {% block loading %}
        {# Loading overlay will be implemented here #}
    {% endblock %}

    <!-- Bottom Scripts -->
    {% include 'core/partials/_base_scripts_bottom.html' %}

    <!-- Page-specific scripts -->
    {% block extra_js %}{% endblock %}

</body>
</html>