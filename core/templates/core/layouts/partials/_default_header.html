{% load static %}
{# Default Header Component - Responsive header with navigation and theme toggle #}
<div class="container">
    <div class="h-16 flex items-center justify-between">
        
        <!-- Left: Logo and Navigation -->
        <div class="flex items-center space-x-6">
            <!-- Grove Logo -->
            <div class="flex-shrink-0">
                <a href="{% url 'core:dashboard' %}" class="flex items-center space-x-3 group">
                    <img src="{% static SITE_LOGO %}" 
                         alt="{{ SITE_NAME }}" 
                         class="h-10 w-auto transition-transform group-hover:scale-105"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="hidden items-center justify-center w-10 h-10 bg-green-600 rounded-lg text-white font-bold text-lg shadow-md">
                        G
                    </div>
                    <span class="text-xl font-bold text-gray-800 dark:text-gray-100 tracking-tight">
                        {{ SITE_NAME }}
                    </span>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-1" role="navigation" aria-label="Main navigation">
                <a href="{% url 'core:dashboard' %}" 
                   class="px-3 py-2 text-sm font-medium rounded-md transition-colors
                          {% if 'dashboard' in request.resolver_match.url_name %}
                              bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                          {% else %}
                              text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                          {% endif %}">
                    Dashboard
                </a>
                
                <a href="{% url 'projects:project_list' %}" 
                   class="px-3 py-2 text-sm font-medium rounded-md transition-colors
                          {% if 'projects' in request.resolver_match.namespace %}
                              bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                          {% else %}
                              text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                          {% endif %}">
                    Projects
                </a>
                
                <a href="{% url 'experiments:public_experiment_list' %}" 
                   class="px-3 py-2 text-sm font-medium rounded-md transition-colors
                          {% if 'experiments' in request.resolver_match.namespace %}
                              bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                          {% else %}
                              text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                          {% endif %}">
                    Experiments
                </a>
            </nav>
        </div>

        <!-- Right: Actions and User Menu -->
        <div class="flex items-center space-x-4">
            
            <!-- Theme Toggle -->
            <button @click="toggleTheme()" 
                    class="p-2 text-foreground-muted dark:text-darcula-foreground-muted hover:text-foreground-default dark:hover:text-darcula-foreground hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter rounded-lg transition-colors"
                    title="Toggle theme"
                    aria-label="Toggle theme">
                <!-- Sun Icon (visible in dark mode) -->
                <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                <!-- Moon Icon (visible in light mode) -->
                <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </button>

            <!-- Notifications (Desktop) -->
            {% if user.is_authenticated %}
                <div class="hidden md:block">
                    {% include 'core/partials/_header_notifications.html' %}
                </div>
            {% endif %}

            <!-- User Menu -->
            {% if user.is_authenticated %}
                <div class="relative" x-data="{ open: false }">
                    <button @click="open = !open" 
                            class="flex items-center space-x-2 p-2 text-sm rounded-lg hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter transition-colors"
                            aria-expanded="false"
                            aria-haspopup="true">
                        <div class="w-8 h-8 bg-brand-100 dark:bg-brand-900/20 rounded-full flex items-center justify-center">
                            <span class="text-brand-600 dark:text-brand-400 font-semibold text-sm">
                                {{ user.username|first|upper }}
                            </span>
                        </div>
                        <span class="hidden md:block text-foreground-default dark:text-darcula-foreground font-medium">
                            {{ user.get_full_name|default:user.username }}
                        </span>
                        <svg class="w-4 h-4 text-foreground-muted dark:text-darcula-foreground-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>

                    <!-- User Dropdown -->
                    <div x-show="open" 
                         @click.away="open = false"
                         x-transition:enter="transition ease-out duration-100"
                         x-transition:enter-start="transform opacity-0 scale-95"
                         x-transition:enter-end="transform opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="transform opacity-100 scale-100"
                         x-transition:leave-end="transform opacity-0 scale-95"
                         class="absolute right-0 mt-2 w-48 origin-top-right bg-background-primary dark:bg-darcula-background-darker border border-border-default dark:border-darcula-border rounded-lg shadow-lg z-50"
                         x-cloak>
                        <div class="py-1" role="menu">
                            <a href="#" class="block px-4 py-2 text-sm text-foreground-default dark:text-darcula-foreground hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter transition-colors" role="menuitem">
                                Profile
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-foreground-default dark:text-darcula-foreground hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter transition-colors" role="menuitem">
                                Settings
                            </a>
                            <div class="border-t border-border-muted dark:border-darcula-border-light my-1"></div>
                            <a href="{% url 'admin:logout' %}" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors" role="menuitem">
                                Sign out
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <a href="{% url 'admin:login' %}" 
                   class="px-4 py-2 text-sm font-medium text-white bg-brand-primary hover:bg-brand-secondary rounded-lg transition-colors">
                    Sign in
                </a>
            {% endif %}

            <!-- Mobile menu button -->
            <button class="md:hidden p-2 text-foreground-muted dark:text-darcula-foreground-muted hover:text-foreground-default dark:hover:text-darcula-foreground hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter rounded-lg transition-colors"
                    @click="mobileMenuOpen = !mobileMenuOpen"
                    aria-label="Toggle mobile menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div x-show="mobileMenuOpen" 
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-95"
         class="md:hidden border-t border-border-default dark:border-darcula-border pt-4 pb-3"
         x-cloak>
        <nav class="space-y-1" role="navigation" aria-label="Mobile navigation">
            <a href="{% url 'core:dashboard' %}" 
               class="block px-3 py-2 text-base font-medium rounded-md transition-colors
                      {% if 'dashboard' in request.resolver_match.url_name %}
                          bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                      {% else %}
                          text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                      {% endif %}">
                Dashboard
            </a>
            
            <a href="{% url 'projects:project_list' %}" 
               class="block px-3 py-2 text-base font-medium rounded-md transition-colors
                      {% if 'projects' in request.resolver_match.namespace %}
                          bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                      {% else %}
                          text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                      {% endif %}">
                Projects
            </a>
            
            <a href="{% url 'experiments:public_experiment_list' %}" 
               class="block px-3 py-2 text-base font-medium rounded-md transition-colors
                      {% if 'experiments' in request.resolver_match.namespace %}
                          bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400
                      {% else %}
                          text-foreground-muted dark:text-darcula-foreground-muted hover:text-brand-700 dark:hover:text-brand-400 hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter
                      {% endif %}">
                Experiments
            </a>
        </nav>

        <!-- Mobile Notifications -->
        {% if user.is_authenticated %}
            <div class="mt-3 pt-3 border-t border-border-muted dark:border-darcula-border-light">
                {% include 'core/partials/_header_notifications.html' %}
            </div>
        {% endif %}
    </div>
</div>