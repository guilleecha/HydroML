{% load static %}
<!DOCTYPE html>
<html lang="es" class="h-full" :class="{ 'dark': darkMode }">

<!-- Head Section -->
{% include 'core/partials/_base_head.html' %}

<body class="h-full bg-background-primary dark:bg-onedark-background font-sans antialiased" x-data="hydroMLApp" x-init="init()">
    
    <!-- Head Scripts (Sentry, app.js, Alpine.js) -->
    {% include 'core/partials/_base_scripts_head.html' %}

    <!-- Upload Data Slide-Over Panel -->
    <div x-show="isUploadPanelOpen" 
         @close-upload-panel.window="isUploadPanelOpen = false"
         class="fixed inset-0 z-50"
         x-cloak>
        
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-gray-600/75" 
             @click="isUploadPanelOpen = false"></div>
        
        <!-- Panel -->
        <div class="fixed inset-y-0 right-0 flex max-w-full pl-10 sm:pl-16">
            
            <div class="w-screen max-w-2xl">
                <div class="flex h-full flex-col bg-background-primary dark:bg-darcula-background-darker shadow-xl border-l border-border-default dark:border-darcula-border-light">
                    
                    <!-- Header -->
                    <div class="flex min-h-0 flex-1 flex-col">
                        <div class="bg-background-secondary dark:bg-darcula-background border-b border-border-default dark:border-darcula-border-light px-4 py-6 sm:px-6">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-semibold text-foreground-default dark:text-darcula-foreground">
                                    Subir Nueva Fuente de Datos
                                </h2>
                                <div class="ml-3 flex h-7 items-center">
                                    <button type="button" 
                                            @click="isUploadPanelOpen = false"
                                            class="rounded-md bg-transparent text-foreground-muted dark:text-darcula-foreground-muted hover:text-foreground-default dark:hover:text-darcula-foreground focus:outline-none focus:ring-2 focus:ring-darcula-accent">
                                        <span class="sr-only">Cerrar panel</span>
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="relative flex-1 px-4 py-6 sm:px-6">
                            <iframe src="{% url 'projects:datasource_create_iframe' %}" 
                                    class="w-full h-full border-0 rounded-lg"
                                    frameborder="0">
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Slide-Over Panel -->
    <div x-show="isProjectPanelOpen" 
         @close-project-panel.window="isProjectPanelOpen = false"
         class="fixed inset-0 z-50"
         x-cloak>
        
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-gray-600/75" 
             @click="isProjectPanelOpen = false"></div>
        
        <!-- Panel -->
        <div class="fixed inset-y-0 right-0 flex max-w-full pl-10 sm:pl-16">
            
            <div class="w-screen max-w-2xl">
                <div class="flex h-full flex-col bg-background-primary dark:bg-darcula-background-darker shadow-xl border-l border-border-default dark:border-darcula-border-light">
                    
                    <!-- Header -->
                    <div class="flex min-h-0 flex-1 flex-col">
                        <div class="bg-background-secondary dark:bg-darcula-background border-b border-border-default dark:border-darcula-border-light px-4 py-6 sm:px-6">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-semibold text-foreground-default dark:text-darcula-foreground">
                                    Crear Nuevo Proyecto
                                </h2>
                                <div class="ml-3 flex h-7 items-center">
                                    <button type="button" 
                                            @click="isProjectPanelOpen = false"
                                            class="rounded-md bg-transparent text-foreground-muted dark:text-darcula-foreground-muted hover:text-foreground-default dark:hover:text-darcula-foreground focus:outline-none focus:ring-2 focus:ring-darcula-accent">
                                        <span class="sr-only">Cerrar panel</span>
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="relative flex-1 px-4 py-6 sm:px-6">
                            <iframe src="{% url 'projects:project_create_iframe' %}" 
                                    class="w-full h-full border-0 rounded-lg"
                                    frameborder="0">
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Layout Container -->
    <div class="h-full">
        <!-- Main Content -->
        <div class="flex flex-col min-w-0 bg-background-primary dark:bg-onedark-background h-full">
            
            <!-- Header -->
            <header class="flex-shrink-0 bg-background-primary dark:bg-darcula-background border-b border-border-default dark:border-darcula-border sticky top-0 z-40">
                <div class="px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                    
                    <!-- Left: Breadcrumbs -->
                    <div class="flex items-center min-w-0 flex-1">
                        {% include 'core/_breadcrumbs.html' %}
                    </div>

                    <!-- Right: Actions & User Menu -->
                    <div class="flex items-center space-x-4">
                        {% if user.is_authenticated %}
                            <div class="hidden md:flex items-center space-x-4">
                                
                                <!-- Theme Toggle -->
                                <button @click="toggleTheme()" 
                                        class="p-2 text-foreground-muted dark:text-darcula-foreground-muted hover:text-foreground-default dark:hover:text-darcula-foreground hover:bg-background-tertiary dark:hover:bg-darcula-background-lighter rounded-lg transition-colors"
                                        title="Cambiar tema">
                                    <!-- Sun Icon (visible in dark mode) -->
                                    <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                    <!-- Moon Icon (visible in light mode) -->
                                    <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                    </svg>
                                </button>

                                <!-- Notifications -->
                                {% include 'core/partials/_header_notifications.html' %}

                                <!-- User Profile -->
                                {% include 'core/partials/_header_user_menu.html' %}
                            </div>
                        {% endif %}
                        
                        <!-- Mobile User Menu -->
                        {% if user.is_authenticated %}
                            <div class="md:hidden">
                                <div class="w-8 h-8 bg-brand-100 dark:bg-darcula-accent/20 rounded-full flex items-center justify-center">
                                    <span class="text-brand-600 dark:text-darcula-accent font-semibold text-sm">{{ user.username|first|upper }}</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto bg-background-primary dark:bg-onedark-background text-foreground-default dark:text-onedark-foreground text-sm">
                <div class="p-6 lg:p-8 bg-background-primary dark:bg-onedark-background min-h-full">
                    
                    <!-- Messages -->
                    {% include 'core/partials/_messages.html' %}

                    <!-- Page Content -->
                    {% block content %}
                    {% endblock %}
                </div>
            </main>
        </div>
    </div>

    <!-- Global Loading Overlay -->
    {% include 'core/_loading_overlay.html' %}

    <!-- Bottom Scripts -->
    {% include 'core/partials/_base_scripts_bottom.html' %}

</body>
</html>