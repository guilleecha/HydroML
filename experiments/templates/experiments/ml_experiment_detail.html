{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="max-w-5xl mx-auto py-8">
    <div id="task-error-alert"></div>

    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-800">{{ experiment.name }}</h1>
        <span id="experiment-status-badge" class="px-3 py-1 rounded-full text-sm font-semibold"
              data-status-url="{% url 'experiments:get_experiment_status' experiment_id=experiment.id %}">
            </span>
    </div>

    <div class="bg-white shadow rounded-lg p-4 mb-8 flex flex-wrap gap-4">
        </div>

    <div class="border-b border-gray-200 mb-6">
        <nav class="flex space-x-8" aria-label="Tabs">
            <button id="tab-results-btn" class="py-4 px-1 text-sm font-medium text-blue-600 border-b-2 border-blue-600" type="button">
                Resultados y Gráficos
            </button>
            <button id="tab-config-btn" class="py-4 px-1 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-blue-600" type="button">
                Configuración Detallada
            </button>
        </nav>
    </div>

    <div id="tab-results">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            {% if experiment.results.prediction_data %}
            <div class="bg-white shadow rounded-lg p-6">
                <canvas id="predictionScatterChart"></canvas>
            </div>
            {% endif %}
            
            {% if experiment.results.feature_importance %}
            <div class="bg-white shadow rounded-lg p-6">
                <canvas id="featureImportanceChart"></canvas>
            </div>
            {% endif %}
        </div>
    </div>

    <div id="tab-config" class="hidden">
        </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    {# Scripts para pasar datos del backend al frontend #}
    {% if experiment.results.prediction_data %}
        <script id="scatter-data" type="application/json">{{ experiment.results.prediction_data|safe }}</script>
    {% endif %}
    {% if experiment.results.feature_importance %}
        <script id="feature-importance-data" type="application/json">{{ experiment.results.feature_importance|safe }}</script>
    {% endif %}

    {# Scripts de la aplicación #}
    <script src="{% static 'experiments/js/experiment_status.js' %}"></script>
    
    {# Esta línea es correcta, asumiendo que la configuración de Django también lo es. #}
    <script src="{% static 'experiments/js/experiment_charts.js' %}"></script>
{% endblock %}