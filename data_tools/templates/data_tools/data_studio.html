{% extends "core/base_main.html" %}
{% load static %}

{% block page_title %}Data Studio - {{ datasource.name }}{% endblock %}

{% block page_heading %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/components/grove-sidebar.css' %}">
<link rel="stylesheet" href="{% static 'core/css/components/grove-nav-section.css' %}">
<link rel="stylesheet" href="{% static 'core/css/components/grove-session-controls.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/tanstack-table.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-extensions.css' %}">
{% endblock %}

{% block header_actions %}
<!-- Data Studio no necesita header actions - sidebar fija presente -->
{% endblock %}

{% block content %}
<!-- Data Studio Two-Column Layout -->
<div class="grove-sidebar-layout">
    
    <!-- Include Fixed Data Tools Sidebar -->
    {% include "data_tools/partials/_data_tools_sidebar.html" %}

    <!-- Main Data Studio Content Area -->
    <main class="grove-main-content">
        <div class="p-8">
        <div class="max-w-4xl mx-auto">
            
            <!-- Basic Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    ðŸ”§ Data Studio - {{ datasource.name }}
                </h1>
                <p class="text-sm text-gray-500">
                    {{ automated_analysis.basic_info.total_rows|floatformat:0 }} rows â€¢ {{ datasource.file.name }}
                </p>
            </div>

        <!-- Enhanced Data Table Section with TanStack -->
        {% include "data_tools/partials/_tanstack_table.html" %}


        </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<!-- Data Studio Utilities -->
<script src="{% static 'data_tools/js/data_studio_ui_utils.js' %}"></script>
<script src="{% static 'data_tools/js/data_studio_api.js' %}"></script>

<!-- Modular Sidebar Components (Load order is important) -->
<script src="{% static 'data_tools/js/sidebar/UIStateManager.js' %}"></script>
<script src="{% static 'data_tools/js/sidebar/SessionManager.js' %}"></script>
<script src="{% static 'data_tools/js/sidebar/ColumnOperationsManager.js' %}"></script>
<script src="{% static 'data_tools/js/sidebar/DataAnalysisManager.js' %}"></script>
<script src="{% static 'data_tools/js/sidebar/IntegrationManager.js' %}"></script>
<script src="{% static 'data_tools/js/sidebar/DataStudioSidebarController.js' %}"></script>

<!-- TanStack Table Implementation - Orden optimizado para carga local -->
<script src="{% static 'data_tools/js/tanstack-bootstrap.js' %}"></script>
<script src="{% static 'data_tools/js/tanstack/tanstack-table-config.js' %}"></script>
<script src="{% static 'data_tools/js/tanstack/tanstack-table-core.js' %}"></script>
<script src="{% static 'data_tools/js/tanstack-table.js' %}"></script>

<script>
// Pasar datos de Django a JavaScript (patrÃ³n estÃ¡ndar Django)
window.gridRowData = {{ grid_data_json|safe }};
window.columnDefsData = {{ column_defs_json|safe }};
window.datasourceId = '{{ datasource.id }}';
window.datasourceName = '{{ datasource.name }}';

console.log('ðŸ“Š Django Data loaded:', {
    rows: window.gridRowData?.length || 0,
    columns: window.columnDefsData?.length || 0,
    datasourceId: window.datasourceId
});
</script>
{% endblock %}