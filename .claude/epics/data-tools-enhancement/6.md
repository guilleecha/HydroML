# Issue 6: CSS Architecture Modernization

## Issue Information
- **Issue ID**: 6
- **Epic**: data-tools-enhancement
- **Title**: CSS Architecture Modernization
- **Status**: Pending
- **Priority**: High
- **Assignee**: Claude Code
- **Created**: 2025-01-22
- **Estimated Effort**: 1.5 days

## Problem Description
Data Studio lacks a cohesive CSS architecture that integrates with Grove design tokens and modern CSS practices, leading to inconsistent styling and maintenance challenges.

### Current CSS Issues
1. **No Design Token Integration**: Missing Grove design system variables
2. **Inconsistent Architecture**: No organized CSS file structure
3. **Missing Responsive System**: Ad-hoc responsive design approach
4. **No Component System**: Styles scattered across templates and inline CSS
5. **Performance Issues**: Redundant CSS and unused styles

### Target Architecture
Create a modern, maintainable CSS system that:
- Uses Grove design tokens consistently
- Follows component-based architecture
- Implements responsive design principles
- Optimizes performance and maintainability

## Current File Analysis

### Existing CSS Structure
```
data_tools/static/data_tools/css/
└── (no organized CSS files)

# CSS currently embedded in:
data_tools/templates/data_tools/data_studio.html (inline styles)
data_tools/templates/data_tools/_data_studio_sidebar.html (inline styles)
```

### Required New Structure
```
data_tools/static/data_tools/css/
├── data-studio-layout.css      # Layout system (from Issue 1)
├── data-studio-base.css        # Base styling system (from Issues 2,4,5)
├── data-studio-components.css  # Component-specific styles
├── data-studio-utilities.css   # Utility classes
└── data-studio-responsive.css  # Responsive design system

core/static/core/css/layouts/
└── data-studio-layout.css      # Grove integration layer
```

## Technical Solution

### 1. Grove Design Token Integration
```css
/* NEW: data-studio-base.css - Design token foundation */
:root {
    /* Data Studio specific variables extending Grove tokens */
    --data-studio-primary: var(--grove-primary);
    --data-studio-secondary: var(--grove-secondary);
    --data-studio-bg-primary: var(--grove-bg-primary);
    --data-studio-bg-surface: var(--grove-bg-surface);
    --data-studio-bg-hover: var(--grove-bg-hover);
    
    /* Layout variables */
    --data-studio-sidebar-width: 280px;
    --data-studio-sidebar-width-collapsed: 64px;
    --data-studio-header-height: var(--grove-headbar-height, 4rem);
    --data-studio-content-padding: var(--grove-spacing-lg);
    
    /* Component sizing */
    --data-studio-card-radius: var(--grove-border-radius-lg);
    --data-studio-button-radius: var(--grove-border-radius-md);
    --data-studio-input-radius: var(--grove-border-radius-md);
    
    /* Animation variables */
    --data-studio-transition-fast: 0.15s ease;
    --data-studio-transition-normal: 0.3s ease;
    --data-studio-transition-slow: 0.5s ease;
    
    /* Z-index scale */
    --data-studio-z-base: 1;
    --data-studio-z-sidebar: 10;
    --data-studio-z-header: 20;
    --data-studio-z-dropdown: 50;
    --data-studio-z-modal: 100;
    --data-studio-z-tooltip: 200;
    
    /* Grid system */
    --data-studio-grid-cols: 12;
    --data-studio-grid-gap: var(--grove-spacing-md);
    --data-studio-grid-margin: var(--grove-spacing-lg);
}

/* Dark mode overrides */
@media (prefers-color-scheme: dark) {
    :root {
        --data-studio-bg-primary: var(--grove-bg-primary-dark);
        --data-studio-bg-surface: var(--grove-bg-surface-dark);
        --data-studio-bg-hover: var(--grove-bg-hover-dark);
    }
}

/* Theme class overrides for explicit dark mode */
.dark {
    --data-studio-bg-primary: var(--grove-bg-primary-dark);
    --data-studio-bg-surface: var(--grove-bg-surface-dark);
    --data-studio-bg-hover: var(--grove-bg-hover-dark);
}
```

### 2. Layout System Architecture
```css
/* NEW: data-studio-layout.css - Comprehensive layout system */

/* Container System */
.data-studio-container {
    position: fixed;
    top: var(--data-studio-header-height);
    left: 0;
    right: 0;
    bottom: 0;
    width: 100vw;
    height: calc(100vh - var(--data-studio-header-height));
    display: flex;
    background: var(--data-studio-bg-primary);
    transition: top var(--data-studio-transition-normal),
                height var(--data-studio-transition-normal);
    z-index: var(--data-studio-z-base);
    overflow: hidden;
}

/* Sidebar Layout */
.data-studio-sidebar {
    width: var(--data-studio-sidebar-width);
    min-width: var(--data-studio-sidebar-width);
    background: var(--data-studio-bg-surface);
    border-right: 1px solid var(--grove-border-color);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    overflow-x: hidden;
    transition: width var(--data-studio-transition-normal),
                min-width var(--data-studio-transition-normal);
    z-index: var(--data-studio-z-sidebar);
}

.data-studio-sidebar.collapsed {
    width: var(--data-studio-sidebar-width-collapsed);
    min-width: var(--data-studio-sidebar-width-collapsed);
}

/* Main Content Layout */
.data-studio-main {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.data-studio-content {
    flex: 1;
    padding: var(--data-studio-content-padding);
    overflow: auto;
    background: var(--data-studio-bg-primary);
}

/* Grid System */
.data-studio-grid {
    display: grid;
    grid-template-columns: repeat(var(--data-studio-grid-cols), 1fr);
    gap: var(--data-studio-grid-gap);
    margin: 0 var(--data-studio-grid-margin);
}

.data-studio-col-1 { grid-column: span 1; }
.data-studio-col-2 { grid-column: span 2; }
.data-studio-col-3 { grid-column: span 3; }
.data-studio-col-4 { grid-column: span 4; }
.data-studio-col-6 { grid-column: span 6; }
.data-studio-col-8 { grid-column: span 8; }
.data-studio-col-12 { grid-column: span 12; }

/* Responsive Layout */
@media (max-width: 1024px) {
    .data-studio-sidebar {
        width: 240px;
        min-width: 240px;
    }
    
    .data-studio-content {
        padding: var(--grove-spacing-md);
    }
}

@media (max-width: 768px) {
    .data-studio-container {
        flex-direction: column;
    }
    
    .data-studio-sidebar {
        width: 100%;
        min-width: 100%;
        height: auto;
        max-height: 40vh;
        border-right: none;
        border-bottom: 1px solid var(--grove-border-color);
    }
    
    .data-studio-content {
        padding: var(--grove-spacing-sm);
    }
    
    .data-studio-grid {
        grid-template-columns: 1fr;
        margin: 0;
    }
}

@media (max-width: 480px) {
    .data-studio-content {
        padding: var(--grove-spacing-xs);
    }
}
```

### 3. Component System
```css
/* NEW: data-studio-components.css - Reusable component styles */

/* Card Components */
.data-studio-card {
    background: var(--data-studio-bg-surface);
    border: 1px solid var(--grove-border-color);
    border-radius: var(--data-studio-card-radius);
    padding: var(--grove-spacing-lg);
    box-shadow: var(--grove-shadow-sm);
    transition: box-shadow var(--data-studio-transition-fast);
}

.data-studio-card:hover {
    box-shadow: var(--grove-shadow-md);
}

.data-studio-card-header {
    margin-bottom: var(--grove-spacing-md);
    padding-bottom: var(--grove-spacing-sm);
    border-bottom: 1px solid var(--grove-border-color);
}

.data-studio-card-title {
    font-size: var(--grove-text-lg);
    font-weight: var(--grove-font-semibold);
    color: var(--grove-text-primary);
    margin: 0;
}

.data-studio-card-content {
    color: var(--grove-text-secondary);
}

/* Status Components */
.data-studio-status {
    display: inline-flex;
    align-items: center;
    gap: var(--grove-spacing-xs);
    padding: var(--grove-spacing-xs) var(--grove-spacing-sm);
    border-radius: var(--grove-border-radius-full);
    font-size: var(--grove-text-xs);
    font-weight: var(--grove-font-medium);
}

.data-studio-status--active {
    background: var(--grove-green-100);
    color: var(--grove-green-800);
}

.data-studio-status--inactive {
    background: var(--grove-gray-100);
    color: var(--grove-gray-600);
}

.data-studio-status--error {
    background: var(--grove-red-100);
    color: var(--grove-red-800);
}

.data-studio-status-dot {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 50%;
    background: currentColor;
}

/* Loading Components */
.data-studio-loading {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--grove-spacing-lg);
}

.data-studio-spinner {
    width: 2rem;
    height: 2rem;
    border: 2px solid var(--grove-border-color);
    border-top: 2px solid var(--grove-primary);
    border-radius: 50%;
    animation: data-studio-spin 1s linear infinite;
}

@keyframes data-studio-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Form Components */
.data-studio-form-group {
    margin-bottom: var(--grove-spacing-md);
}

.data-studio-label {
    display: block;
    font-size: var(--grove-text-sm);
    font-weight: var(--grove-font-medium);
    color: var(--grove-text-primary);
    margin-bottom: var(--grove-spacing-xs);
}

.data-studio-input {
    width: 100%;
    padding: var(--grove-spacing-sm) var(--grove-spacing-md);
    border: 1px solid var(--grove-border-color);
    border-radius: var(--data-studio-input-radius);
    background: var(--grove-bg-primary);
    color: var(--grove-text-primary);
    font-size: var(--grove-text-sm);
    transition: border-color var(--data-studio-transition-fast),
                box-shadow var(--data-studio-transition-fast);
}

.data-studio-input:focus {
    outline: none;
    border-color: var(--grove-primary);
    box-shadow: 0 0 0 3px var(--grove-primary-alpha-20);
}

.data-studio-input:disabled {
    background: var(--grove-bg-disabled);
    color: var(--grove-text-disabled);
    cursor: not-allowed;
}

/* Table Components */
.data-studio-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--data-studio-bg-surface);
    border-radius: var(--data-studio-card-radius);
    overflow: hidden;
    box-shadow: var(--grove-shadow-sm);
}

.data-studio-table th,
.data-studio-table td {
    padding: var(--grove-spacing-sm) var(--grove-spacing-md);
    text-align: left;
    border-bottom: 1px solid var(--grove-border-color);
}

.data-studio-table th {
    background: var(--grove-bg-surface);
    font-weight: var(--grove-font-semibold);
    color: var(--grove-text-primary);
    font-size: var(--grove-text-sm);
}

.data-studio-table td {
    color: var(--grove-text-secondary);
    font-size: var(--grove-text-sm);
}

.data-studio-table tr:hover {
    background: var(--data-studio-bg-hover);
}

/* Notification Components */
.data-studio-notification {
    display: flex;
    align-items: flex-start;
    gap: var(--grove-spacing-sm);
    padding: var(--grove-spacing-md);
    border-radius: var(--grove-border-radius-md);
    border-left: 4px solid;
    margin-bottom: var(--grove-spacing-sm);
}

.data-studio-notification--success {
    background: var(--grove-green-50);
    border-color: var(--grove-green-500);
    color: var(--grove-green-800);
}

.data-studio-notification--error {
    background: var(--grove-red-50);
    border-color: var(--grove-red-500);
    color: var(--grove-red-800);
}

.data-studio-notification--warning {
    background: var(--grove-yellow-50);
    border-color: var(--grove-yellow-500);
    color: var(--grove-yellow-800);
}

.data-studio-notification--info {
    background: var(--grove-blue-50);
    border-color: var(--grove-blue-500);
    color: var(--grove-blue-800);
}
```

### 4. Utility System
```css
/* NEW: data-studio-utilities.css - Utility classes */

/* Spacing Utilities */
.ds-m-0 { margin: 0; }
.ds-m-1 { margin: var(--grove-spacing-xs); }
.ds-m-2 { margin: var(--grove-spacing-sm); }
.ds-m-3 { margin: var(--grove-spacing-md); }
.ds-m-4 { margin: var(--grove-spacing-lg); }
.ds-m-5 { margin: var(--grove-spacing-xl); }

.ds-p-0 { padding: 0; }
.ds-p-1 { padding: var(--grove-spacing-xs); }
.ds-p-2 { padding: var(--grove-spacing-sm); }
.ds-p-3 { padding: var(--grove-spacing-md); }
.ds-p-4 { padding: var(--grove-spacing-lg); }
.ds-p-5 { padding: var(--grove-spacing-xl); }

/* Directional spacing */
.ds-mt-0 { margin-top: 0; }
.ds-mt-1 { margin-top: var(--grove-spacing-xs); }
.ds-mt-2 { margin-top: var(--grove-spacing-sm); }
.ds-mt-3 { margin-top: var(--grove-spacing-md); }
.ds-mt-4 { margin-top: var(--grove-spacing-lg); }

.ds-mb-0 { margin-bottom: 0; }
.ds-mb-1 { margin-bottom: var(--grove-spacing-xs); }
.ds-mb-2 { margin-bottom: var(--grove-spacing-sm); }
.ds-mb-3 { margin-bottom: var(--grove-spacing-md); }
.ds-mb-4 { margin-bottom: var(--grove-spacing-lg); }

/* Display Utilities */
.ds-hidden { display: none; }
.ds-block { display: block; }
.ds-inline { display: inline; }
.ds-inline-block { display: inline-block; }
.ds-flex { display: flex; }
.ds-grid { display: grid; }

/* Flex Utilities */
.ds-flex-row { flex-direction: row; }
.ds-flex-col { flex-direction: column; }
.ds-flex-wrap { flex-wrap: wrap; }
.ds-flex-nowrap { flex-wrap: nowrap; }
.ds-justify-start { justify-content: flex-start; }
.ds-justify-center { justify-content: center; }
.ds-justify-end { justify-content: flex-end; }
.ds-justify-between { justify-content: space-between; }
.ds-items-start { align-items: flex-start; }
.ds-items-center { align-items: center; }
.ds-items-end { align-items: flex-end; }

/* Text Utilities */
.ds-text-xs { font-size: var(--grove-text-xs); }
.ds-text-sm { font-size: var(--grove-text-sm); }
.ds-text-base { font-size: var(--grove-text-base); }
.ds-text-lg { font-size: var(--grove-text-lg); }
.ds-text-xl { font-size: var(--grove-text-xl); }

.ds-font-normal { font-weight: var(--grove-font-normal); }
.ds-font-medium { font-weight: var(--grove-font-medium); }
.ds-font-semibold { font-weight: var(--grove-font-semibold); }
.ds-font-bold { font-weight: var(--grove-font-bold); }

.ds-text-left { text-align: left; }
.ds-text-center { text-align: center; }
.ds-text-right { text-align: right; }

.ds-text-primary { color: var(--grove-text-primary); }
.ds-text-secondary { color: var(--grove-text-secondary); }
.ds-text-muted { color: var(--grove-text-muted); }

/* Border Utilities */
.ds-border { border: 1px solid var(--grove-border-color); }
.ds-border-t { border-top: 1px solid var(--grove-border-color); }
.ds-border-b { border-bottom: 1px solid var(--grove-border-color); }
.ds-border-l { border-left: 1px solid var(--grove-border-color); }
.ds-border-r { border-right: 1px solid var(--grove-border-color); }

.ds-rounded-none { border-radius: 0; }
.ds-rounded-sm { border-radius: var(--grove-border-radius-sm); }
.ds-rounded { border-radius: var(--grove-border-radius-md); }
.ds-rounded-lg { border-radius: var(--grove-border-radius-lg); }
.ds-rounded-full { border-radius: var(--grove-border-radius-full); }

/* Background Utilities */
.ds-bg-primary { background: var(--data-studio-bg-primary); }
.ds-bg-surface { background: var(--data-studio-bg-surface); }
.ds-bg-hover { background: var(--data-studio-bg-hover); }

/* Animation Utilities */
.ds-transition { transition: all var(--data-studio-transition-fast); }
.ds-transition-normal { transition: all var(--data-studio-transition-normal); }
.ds-transition-slow { transition: all var(--data-studio-transition-slow); }

/* Responsive Utilities */
@media (max-width: 768px) {
    .ds-md-hidden { display: none; }
    .ds-md-block { display: block; }
    .ds-md-flex { display: flex; }
}

@media (max-width: 480px) {
    .ds-sm-hidden { display: none; }
    .ds-sm-block { display: block; }
    .ds-sm-flex { display: flex; }
}
```

### 5. Responsive Design System
```css
/* NEW: data-studio-responsive.css - Mobile-first responsive system */

/* Base styles (mobile first) */
.data-studio-responsive-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--grove-spacing-sm);
    padding: var(--grove-spacing-sm);
}

/* Tablet styles */
@media (min-width: 768px) {
    .data-studio-responsive-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--grove-spacing-md);
        padding: var(--grove-spacing-md);
    }
    
    .data-studio-tablet-2-cols {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .data-studio-tablet-3-cols {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* Desktop styles */
@media (min-width: 1024px) {
    .data-studio-responsive-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--grove-spacing-lg);
        padding: var(--grove-spacing-lg);
    }
    
    .data-studio-desktop-4-cols {
        grid-template-columns: repeat(4, 1fr);
    }
    
    .data-studio-desktop-6-cols {
        grid-template-columns: repeat(6, 1fr);
    }
}

/* Large desktop styles */
@media (min-width: 1440px) {
    .data-studio-responsive-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--grove-spacing-xl);
        padding: var(--grove-spacing-xl);
    }
}

/* Container queries (when supported) */
@container (min-width: 600px) {
    .data-studio-container-responsive {
        grid-template-columns: repeat(2, 1fr);
    }
}

@container (min-width: 900px) {
    .data-studio-container-responsive {
        grid-template-columns: repeat(3, 1fr);
    }
}
```

## Implementation Steps

### Step 1: Create Base Architecture
Create the foundational CSS files:

1. `data_tools/static/data_tools/css/data-studio-base.css`
2. `data_tools/static/data_tools/css/data-studio-layout.css` (if not exists from Issue 1)
3. `data_tools/static/data_tools/css/data-studio-components.css`
4. `data_tools/static/data_tools/css/data-studio-utilities.css`
5. `data_tools/static/data_tools/css/data-studio-responsive.css`

### Step 2: Create Grove Integration Layer
Create `core/static/core/css/layouts/data-studio-layout.css`:

```css
/* Grove integration layer for Data Studio */
@import url('../../../data_tools/static/data_tools/css/data-studio-base.css');

/* Additional Grove-specific overrides */
.data-studio-grove-integration {
    /* Ensure Data Studio respects Grove headbar */
    --data-studio-header-height: var(--grove-headbar-height, 4rem);
    
    /* Grove theme integration */
    color-scheme: var(--grove-color-scheme);
    
    /* Grove focus management */
    --data-studio-focus-ring: var(--grove-focus-ring);
}

/* Grove headbar specific adjustments */
.grove-headbar ~ .data-studio-container,
.wave-headbar ~ .data-studio-container {
    top: var(--grove-headbar-height);
    height: calc(100vh - var(--grove-headbar-height));
}

/* Grove theme compatibility */
.grove-theme-light .data-studio-container {
    --data-studio-bg-primary: var(--grove-bg-primary-light);
    --data-studio-bg-surface: var(--grove-bg-surface-light);
}

.grove-theme-dark .data-studio-container {
    --data-studio-bg-primary: var(--grove-bg-primary-dark);
    --data-studio-bg-surface: var(--grove-bg-surface-dark);
}
```

### Step 3: Update Template Integration
Update `data_tools/templates/data_tools/data_studio.html`:

```html
{% block extra_css %}
<!-- Data Studio CSS Architecture -->
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-base.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-layout.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-components.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-utilities.css' %}">
<link rel="stylesheet" href="{% static 'data_tools/css/data-studio-responsive.css' %}">

<!-- Grove Integration Layer -->
<link rel="stylesheet" href="{% static 'core/css/layouts/data-studio-layout.css' %}">
{% endblock %}
```

### Step 4: Remove Inline Styles
Clean up existing templates by replacing inline styles with CSS classes:

```html
<!-- BEFORE: Inline styles -->
<div style="position: absolute; top: 4rem; left: 0; right: 0; bottom: 0;">

<!-- AFTER: CSS classes -->
<div class="data-studio-container">
```

### Step 5: Create CSS Documentation
Create `data_tools/static/data_tools/css/README.md`:

```markdown
# Data Studio CSS Architecture

## File Structure
- `data-studio-base.css` - Design tokens and base variables
- `data-studio-layout.css` - Layout system and grid
- `data-studio-components.css` - Reusable components
- `data-studio-utilities.css` - Utility classes
- `data-studio-responsive.css` - Responsive design system

## Usage Guidelines
1. Use design tokens for all values
2. Follow component-based architecture
3. Use utility classes for simple styling
4. Maintain responsive design principles

## Grove Integration
All styles integrate with Grove design tokens and respect the Grove headbar system.
```

## Files Created/Modified

### New Files
1. **data_tools/static/data_tools/css/data-studio-base.css**
   - Design token integration
   - CSS variables system
   - Theme compatibility

2. **data_tools/static/data_tools/css/data-studio-components.css**
   - Reusable component styles
   - Card, status, form components
   - Notification system

3. **data_tools/static/data_tools/css/data-studio-utilities.css**
   - Utility class system
   - Spacing, display, text utilities
   - Responsive utilities

4. **data_tools/static/data_tools/css/data-studio-responsive.css**
   - Mobile-first responsive design
   - Breakpoint system
   - Container queries

5. **core/static/core/css/layouts/data-studio-layout.css**
   - Grove integration layer
   - Headbar compatibility
   - Theme integration

6. **data_tools/static/data_tools/css/README.md**
   - Documentation and guidelines

### Modified Files
1. **data_tools/templates/data_tools/data_studio.html**
   - Include new CSS architecture
   - Remove inline styles
   - Add CSS class integration

2. **data_tools/templates/data_tools/_data_studio_sidebar.html**
   - Replace inline styles with CSS classes
   - Add component classes

## Testing Requirements

### Architecture Testing
- [ ] All CSS files load correctly
- [ ] No conflicts between CSS files
- [ ] Design tokens work across components
- [ ] Responsive system functions properly

### Integration Testing
- [ ] Grove design system integration
- [ ] Theme switching compatibility
- [ ] Headbar height adaptation
- [ ] No visual regressions

### Performance Testing
- [ ] CSS bundle size optimization
- [ ] Load time impact measurement
- [ ] Render performance analysis
- [ ] Memory usage assessment

## Acceptance Criteria
- [ ] Complete CSS architecture implementation
- [ ] 100% Grove design token integration
- [ ] Responsive design across all devices
- [ ] Component-based styling system
- [ ] Performance equivalent or better
- [ ] Maintainable and documented code

## Performance Optimizations
- CSS file concatenation in production
- Unused CSS elimination
- Critical CSS inlining
- CSS compression and minification

## Dependencies
- All previous issues (1-5) provide foundation
- Grove design tokens and variables
- Modern CSS feature support (CSS Grid, Custom Properties)

## Related Issues
This issue consolidates and finalizes the CSS work from:
- Issue 1: Layout System Refactoring (base layout)
- Issue 2: Sidebar Margins Evaluation (spacing system)
- Issue 4: Metrics and Icons Integration (component styling)
- Issue 5: Toolbar Grove Integration (button styling)