# Task #3: Implement Django Context Data Integration

**Epic**: Enhanced Grove Headbar  
**Phase**: Analysis & Integration  
**Estimated Effort**: 4-6 hours  
**Dependencies**: Task #2  

## Objective
Create Django context processor and view enhancements to provide real-time count data and breadcrumb context for the enhanced Grove headbar component.

## Scope
- Create context processor for global headbar data
- Update relevant Django views to include count data
- Implement breadcrumb context generation
- Ensure efficient database queries for count operations

## Deliverables
- [ ] New context processor `core/context_processors.py:grove_headbar_context`
- [ ] Updated view classes with headbar data methods
- [ ] Efficient database queries for count aggregation
- [ ] Breadcrumb context generation logic

## Technical Details
### Context Processor Implementation
```python
# core/context_processors.py
def grove_headbar_context(request):
    """Provide global headbar data for all templates"""
    if not request.user.is_authenticated:
        return {}
    
    return {
        'total_workspaces_count': get_user_workspaces_count(request.user),
        'total_datasources_count': get_user_datasources_count(request.user),
        'total_experiments_count': get_user_experiments_count(request.user),
        'current_breadcrumb': generate_breadcrumb_context(request),
    }
```

### Database Query Optimization
- Use `annotate()` and `aggregate()` for efficient counting
- Implement caching for frequently accessed counts
- Create database indexes for count query performance
- Consider using `select_related()` for related data

### Breadcrumb Context Generation
- Analyze current URL pattern to determine context
- Generate appropriate special character breadcrumbs
- Support for workspace-specific contexts
- Handle edge cases for unknown or invalid routes

## Acceptance Criteria
- [ ] Context processor registered in Django settings
- [ ] Count queries execute efficiently (<50ms average)
- [ ] Breadcrumb context correctly identifies current page context
- [ ] Template variables available globally across all views
- [ ] No N+1 query problems introduced

## Implementation Notes
- Add proper error handling for database query failures
- Implement caching strategy for count data (consider Redis integration)
- Test context processor with existing templates to ensure no conflicts
- Document any new template variables for team reference