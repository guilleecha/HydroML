{% extends 'core/base.html' %}
{% load static %}
{% block content %}
  <div class="container mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold mb-6">Resumen de Carga de Datos</h2>
    
    <div id="status-section">
      <div id="processing-indicator" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mb-6">
        <p class="font-bold">Estado:</p>
        <p id="status">Procesando...</p>
      </div>
    </div>

    <div id="quality-report" style="display:none;">
      <!-- General Statistics -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md" role="alert">
          <p class="font-bold">Filas Detectadas</p>
          <p class="text-2xl" id="rows-count">-</p>
        </div>
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md" role="alert">
          <p class="font-bold">Columnas Detectadas</p>
          <p class="text-2xl" id="columns-count">-</p>
        </div>
      </div>

      <!-- Data Types Table -->
      <div class="bg-background-primary dark:bg-darcula-background-darker p-6 rounded-lg shadow-md mb-6 border border-border-default dark:border-darcula-border-light">
        <h3 class="text-xl font-semibold mb-4">Tipos de Datos por Columna</h3>
        <table class="w-full text-sm text-left text-gray-700">
          <thead class="text-xs text-gray-800 uppercase bg-gray-100">
            <tr>
              <th scope="col" class="px-6 py-3">Columna</th>
              <th scope="col" class="px-6 py-3">Tipo de Dato Detectado</th>
            </tr>
          </thead>
          <tbody id="data-types-table">
          </tbody>
        </table>
      </div>

      <!-- Missing Values Table -->
      <div class="bg-background-primary dark:bg-darcula-background-darker p-6 rounded-lg shadow-md border border-border-default dark:border-darcula-border-light">
        <h3 class="text-xl font-semibold mb-4">An√°lisis de Valores Faltantes</h3>
        <table class="w-full text-sm text-left text-gray-700">
          <thead class="text-xs text-gray-800 uppercase bg-gray-100">
            <tr>
              <th scope="col" class="px-6 py-3">Columna</th>
              <th scope="col" class="px-6 py-3">Valores Faltantes</th>
              <th scope="col" class="px-6 py-3">% Faltante</th>
            </tr>
          </thead>
          <tbody id="missing-values-table">
          </tbody>
        </table>
      </div>
    </div>

    <div id="error-section" style="display:none;" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md">
      <p class="font-bold">Error en el procesamiento:</p>
      <p id="error-message"></p>
    </div>
  </div>

  <script>
    // Configure datasource poller
    window.datasourcePollerConfig = {
        datasourceId: "{{ datasource.id }}",
        statusUrl: "{% url 'projects:datasource_upload_summary' datasource_id=datasource.id %}"
    };
  </script>
  <script src="{% static 'js/datasource_status_poller.js' %}"></script>
{% endblock %}
